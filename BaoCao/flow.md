# ğŸ“Š TÃ­nh NÄƒng ChÃ­nh & Luá»“ng Nghiá»‡p Vá»¥ - OpenLearnFoundation

## ğŸ“‹ Má»¥c Lá»¥c

1. [Tá»•ng Quan TÃ­nh NÄƒng](#tá»•ng-quan-tÃ­nh-nÄƒng)
2. [Luá»“ng XÃ¡c Thá»±c & Quáº£n LÃ½ TÃ i Khoáº£n](#luá»“ng-xÃ¡c-thá»±c--quáº£n-lÃ½-tÃ i-khoáº£n)
3. [Luá»“ng Quáº£n LÃ½ TÃ i Liá»‡u](#luá»“ng-quáº£n-lÃ½-tÃ i-liá»‡u)
4. [Luá»“ng Quáº£n LÃ½ KhÃ³a Há»c](#luá»“ng-quáº£n-lÃ½-khÃ³a-há»c)
5. [Luá»“ng Thanh ToÃ¡n](#luá»“ng-thanh-toÃ¡n)
6. [Luá»“ng Forum & Blog](#luá»“ng-forum--blog)
7. [Luá»“ng Quáº£n Trá»‹](#luá»“ng-quáº£n-trá»‹)
8. [Tá»•ng Káº¿t Luá»“ng Nghiá»‡p Vá»¥](#tá»•ng-káº¿t-luá»“ng-nghiá»‡p-vá»¥)

---

## Tá»•ng Quan TÃ­nh NÄƒng

### Danh SÃ¡ch TÃ­nh NÄƒng ChÃ­nh

#### 1. XÃ¡c Thá»±c & Quáº£n LÃ½ NgÆ°á»i DÃ¹ng
- âœ… ÄÄƒng kÃ½ tÃ i khoáº£n
- âœ… ÄÄƒng nháº­p/ÄÄƒng xuáº¥t
- âœ… Quáº£n lÃ½ thÃ´ng tin cÃ¡ nhÃ¢n
- âœ… Upload avatar vÃ  cover image
- âœ… XÃ¡c thá»±c email (tÃ­ch há»£p sáºµn)
- âœ… PhÃ¢n quyá»n (Student, Instructor, Admin)

#### 2. Quáº£n LÃ½ TÃ i Liá»‡u
- âœ… Upload tÃ i liá»‡u (PDF, PPTX, DOCX, ZIP)
- âœ… TÃ¬m kiáº¿m tÃ i liá»‡u nÃ¢ng cao
- âœ… Xem chi tiáº¿t tÃ i liá»‡u
- âœ… Táº£i xuá»‘ng tÃ i liá»‡u
- âœ… Bookmark tÃ i liá»‡u
- âœ… ÄÃ¡nh giÃ¡ vÃ  nháº­n xÃ©t tÃ i liá»‡u
- âœ… Quáº£n lÃ½ tÃ i liá»‡u Ä‘Ã£ upload

#### 3. Quáº£n LÃ½ KhÃ³a Há»c
- âœ… Xem danh sÃ¡ch khÃ³a há»c
- âœ… Xem chi tiáº¿t khÃ³a há»c
- âœ… ÄÄƒng kÃ½ khÃ³a há»c
- âœ… Theo dÃµi tiáº¿n Ä‘á»™ há»c táº­p
- âœ… Quáº£n lÃ½ khÃ³a há»c Ä‘Ã£ Ä‘Äƒng kÃ½
- âœ… Táº¡o khÃ³a há»c (Instructor/Admin)

#### 4. Thanh ToÃ¡n
- âœ… TÃ­ch há»£p PayOS
- âœ… Táº¡o payment link
- âœ… Kiá»ƒm tra tráº¡ng thÃ¡i thanh toÃ¡n
- âœ… Webhook callback

#### 5. Forum & Blog
- âœ… ÄÄƒng bÃ i trong forum
- âœ… Comment vÃ  like bÃ i Ä‘Äƒng
- âœ… Upload áº£nh cho bÃ i Ä‘Äƒng
- âœ… Xem blog posts
- âœ… TÃ¬m kiáº¿m blog theo tags

#### 6. Quáº£n Trá»‹
- âœ… Quáº£n lÃ½ users
- âœ… KhÃ³a/Má»Ÿ khÃ³a tÃ i khoáº£n
- âœ… Xem thá»‘ng kÃª
- âœ… Quáº£n lÃ½ ná»™i dung

---

## Luá»“ng XÃ¡c Thá»±c & Quáº£n LÃ½ TÃ i Khoáº£n

### 1. Luá»“ng ÄÄƒng KÃ½ TÃ i Khoáº£n

#### SÆ¡ Äá»“ Luá»“ng
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Truy cáº­p /signup
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SignUpView     â”‚
â”‚  - Form Ä‘Äƒng kÃ½ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Äiá»n thÃ´ng tin
       â”‚    - Há» tÃªn
       â”‚    - Email
       â”‚    - Máº­t kháº©u
       â”‚    - XÃ¡c nháº­n máº­t kháº©u
       â”‚    - Role (student/instructor)
       â”‚    - ChÆ°Æ¡ng trÃ¬nh há»c
       â”‚    - Äá»“ng Ã½ Ä‘iá»u khoáº£n
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validation     â”‚
â”‚  - Email format â”‚
â”‚  - Password >=6 â”‚
â”‚  - Required fields
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Validate
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend        â”‚
â”‚  POST /api/auth/â”‚
â”‚  register        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. HTTP Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway    â”‚
â”‚  (Port 3000)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Proxy to Auth Service
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auth Service   â”‚
â”‚  (Port 3001)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Validate input
       â”‚    - Check required fields
       â”‚    - Validate email format
       â”‚    - Check password length
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Email    â”‚
â”‚  Exists?        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Yes â†’ Return error: "Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng"
       â”‚
       â””â”€ No â†’ Continue
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash Password  â”‚
â”‚  (Bcrypt)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Hash password vá»›i salt rounds: 10
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create User    â”‚
â”‚  - Generate user_id (UUID)
â”‚  - Set default values
â”‚  - Save to MongoDB
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. Save to UserCollection
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate JWT   â”‚
â”‚  Token          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 9. Create JWT vá»›i user info
       â”‚    - Expiration: 7 days
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response       â”‚
â”‚  - User info    â”‚
â”‚  - JWT token    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 10. Return to Frontend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚
â”‚  - Store token  â”‚
â”‚  - Show success â”‚
â”‚  - Redirect to  â”‚
â”‚    signin       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User truy cáº­p trang Ä‘Äƒng kÃ½**
- URL: `/signup` hoáº·c `/auth?tab=signup`
- Hiá»ƒn thá»‹ form Ä‘Äƒng kÃ½ vá»›i cÃ¡c trÆ°á»ng:
  - Há» vÃ  tÃªn (required)
  - Email (required, unique)
  - Máº­t kháº©u (required, min 6 kÃ½ tá»±)
  - XÃ¡c nháº­n máº­t kháº©u (required, pháº£i khá»›p)
  - Vai trÃ²: Student, Instructor, Guest
  - ChÆ°Æ¡ng trÃ¬nh há»c (optional)
  - Äá»“ng Ã½ Ä‘iá»u khoáº£n (required)

**BÆ°á»›c 2: User Ä‘iá»n form vÃ  submit**
- Frontend validate:
  - Email format
  - Password length >= 6
  - Password confirmation match
  - Required fields
  - Terms acceptance

**BÆ°á»›c 3: Frontend gá»­i request**
```javascript
POST /api/auth/register
Body: {
  fullName: "Nguyá»…n VÄƒn A",
  email: "nguyenvana@example.com",
  passWord: "password123",
  role: "student",
  major: "CÃ´ng nghá»‡ thÃ´ng tin"
}
```

**BÆ°á»›c 4: API Gateway nháº­n request**
- Route matching: `/api/auth` â†’ `authProxy`
- Path rewrite: `/api/auth/register` â†’ `/register`
- Proxy to: `http://localhost:3001/register`

**BÆ°á»›c 5: Auth Service xá»­ lÃ½**
- Validate input
- Check email exists trong MongoDB
- Hash password vá»›i bcrypt
- Generate user_id (UUID format)
- Create user document
- Generate JWT token

**BÆ°á»›c 6: Response**
```json
{
  "success": true,
  "message": "ÄÄƒng kÃ½ thÃ nh cÃ´ng!",
  "data": {
    "user": {
      "id": "...",
      "user_id": "user_...",
      "fullName": "Nguyá»…n VÄƒn A",
      "email": "nguyenvana@example.com",
      "role": "student"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**BÆ°á»›c 7: Frontend xá»­ lÃ½ response**
- Store token vÃ o localStorage
- Store user info
- Show success message
- Redirect to signin hoáº·c home

---

### 2. Luá»“ng ÄÄƒng Nháº­p

#### SÆ¡ Äá»“ Luá»“ng
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Truy cáº­p /signin
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SignInView     â”‚
â”‚  - Form Ä‘Äƒng nháº­pâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Nháº­p email & password
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validation     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Validate
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/auth/â”‚
â”‚  login           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. HTTP Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Proxy to Auth Service
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auth Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Find user by email
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Found?    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ No â†’ Return 401: "Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng"
       â”‚
       â””â”€ Yes â†’ Continue
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check is_activeâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ false â†’ Return 403: "TÃ i khoáº£n bá»‹ khÃ³a"
       â”‚
       â””â”€ true â†’ Continue
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Verify Passwordâ”‚
â”‚  (Bcrypt)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Compare password
       â”‚
       â”œâ”€ No Match â†’ Return 401
       â”‚
       â””â”€ Match â†’ Continue
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update         â”‚
â”‚  last_login     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. Update timestamp
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate JWT   â”‚
â”‚  Token          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 9. Create JWT
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response       â”‚
â”‚  - User info    â”‚
â”‚  - JWT token    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 10. Return to Frontend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚
â”‚  - Store token  â”‚
â”‚  - Store user   â”‚
â”‚  - Redirect to  â”‚
â”‚    home         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User truy cáº­p trang Ä‘Äƒng nháº­p**
- URL: `/signin` hoáº·c `/auth?tab=signin`
- Hiá»ƒn thá»‹ form Ä‘Äƒng nháº­p

**BÆ°á»›c 2: User nháº­p thÃ´ng tin**
- Email
- Password

**BÆ°á»›c 3: Frontend gá»­i request**
```javascript
POST /api/auth/login
Body: {
  email: "nguyenvana@example.com",
  passWord: "password123"
}
```

**BÆ°á»›c 4-5: API Gateway â†’ Auth Service**
- TÆ°Æ¡ng tá»± nhÆ° Ä‘Äƒng kÃ½

**BÆ°á»›c 6: Auth Service xá»­ lÃ½**
- Find user by email
- Check is_active
- Verify password vá»›i bcrypt.compare()
- Update last_login
- Generate JWT token

**BÆ°á»›c 7: Response vÃ  Frontend**
- Return user info + token
- Frontend store token vÃ  user info
- Redirect to home page

---

### 3. Luá»“ng Cáº­p Nháº­t Profile

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Profile Page â†’ Edit Profile Modal
    â†“
Äiá»n thÃ´ng tin má»›i
    â†“
POST /api/auth/customer/update
    â†“
Auth Service
    â”œâ”€ Find user by email
    â”œâ”€ Update fields
    â”œâ”€ Save to MongoDB
    â””â”€ Return updated user
    â†“
Frontend update UI
```

#### CÃ¡c TrÆ°á»ng CÃ³ Thá»ƒ Cáº­p Nháº­t
- Phone
- Address
- Gender
- Bio
- University
- Major
- Avatar (upload riÃªng)
- Cover image (upload riÃªng)

---

### 4. Luá»“ng Upload Avatar/Cover

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Profile Page â†’ Click Upload Avatar
    â†“
Select Image File
    â†“
POST /api/auth/profile/avatar
Content-Type: multipart/form-data
    â†“
Auth Service
    â”œâ”€ Multer middleware
    â”œâ”€ Validate file (image/*, max 5MB)
    â”œâ”€ Save to uploads/avatars/
    â”œâ”€ Update user.avatar_url
    â””â”€ Return new avatar_url
    â†“
Frontend update avatar display
```

---

## Luá»“ng Quáº£n LÃ½ TÃ i Liá»‡u

### 1. Luá»“ng Upload TÃ i Liá»‡u

#### SÆ¡ Äá»“ Luá»“ng
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Click "Táº£i lÃªn tÃ i liá»‡u"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UploadModal    â”‚
â”‚  (4 bÆ°á»›c)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Step 1: Basic Info
       â”‚  - Title (required)
       â”‚  - Program (required)
       â”‚  - Description (required)
       â”‚
       â”œâ”€ Step 2: Tags & License
       â”‚  - Tags
       â”‚  - Language
       â”‚  - Visibility
       â”‚  - License
       â”‚
       â”œâ”€ Step 3: File Upload
       â”‚  - Select document file
       â”‚  - Optional thumbnail
       â”‚  - Accept ToS
       â”‚
       â””â”€ Step 4: Review & Submit
          - Review all info
          - Submit
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create FormData â”‚
â”‚  - file          â”‚
â”‚  - thumbnail     â”‚
â”‚  - title         â”‚
â”‚  - description   â”‚
â”‚  - program       â”‚
â”‚  - tags          â”‚
â”‚  - author_id     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. POST /api/documents/upload
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway    â”‚
â”‚  - Pass through â”‚
â”‚    multipart    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Proxy to Document Service
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Serviceâ”‚
â”‚  (Port 3003)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Multer middleware
       â”‚    - Validate file type
       â”‚    - Validate file size
       â”‚    - Save to disk
       â”‚
       â”œâ”€ File â†’ uploads/documents/
       â””â”€ Thumbnail â†’ uploads/thumbnails/
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Documentâ”‚
â”‚  - Generate     â”‚
â”‚    document_id  â”‚
â”‚  - Extract      â”‚
â”‚    metadata     â”‚
â”‚  - Save to      â”‚
â”‚    MongoDB      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Save to TaiLieu collection
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update User    â”‚
â”‚  - Add to       â”‚
â”‚    uploaded_    â”‚
â”‚    documents    â”‚
â”‚  - Increment    â”‚
â”‚    contributionsâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Update UserCollection
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response       â”‚
â”‚  - document_id  â”‚
â”‚  - document infoâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Return to Frontend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚
â”‚  - Show success â”‚
â”‚  - Close modal  â”‚
â”‚  - Refresh list â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User má»Ÿ Upload Modal**
- Click button "Táº£i lÃªn tÃ i liá»‡u"
- Modal hiá»ƒn thá»‹ vá»›i 4 bÆ°á»›c

**BÆ°á»›c 2: Äiá»n thÃ´ng tin (Step 1)**
- Title: TÃªn tÃ i liá»‡u (required, max 150 chars)
- Program: ChÆ°Æ¡ng trÃ¬nh há»c (required)
- Description: MÃ´ táº£ (required, 20-1000 chars)

**BÆ°á»›c 3: Tags & License (Step 2)**
- Tags: ThÃªm tags (optional)
- Language: NgÃ´n ngá»¯ (vi/en)
- Visibility: Public/Private/Class-only
- License: CC-BY, CC-BY-NC, etc.

**BÆ°á»›c 4: Upload Files (Step 3)**
- Select document file:
  - Types: PDF, PPTX, DOCX, ZIP
  - Max size: 50MB
- Optional thumbnail:
  - Types: JPG, PNG, WEBP
  - Max size: 5MB
- Accept Terms of Service

**BÆ°á»›c 5: Review & Submit (Step 4)**
- Review all information
- Click "HoÃ n táº¥t"

**BÆ°á»›c 6: Frontend táº¡o FormData**
```javascript
const formData = new FormData();
formData.append('file', fileObject);
formData.append('thumbnail', thumbnailObject);
formData.append('title', title);
formData.append('description', description);
formData.append('program', program);
formData.append('author_id', userId);
formData.append('tags', JSON.stringify(tags));
```

**BÆ°á»›c 7: Gá»­i request**
```javascript
POST /api/documents/upload
Content-Type: multipart/form-data
Body: FormData
```

**BÆ°á»›c 8: Document Service xá»­ lÃ½**
- Multer middleware:
  - Validate file type
  - Validate file size
  - Save file to `uploads/documents/`
  - Save thumbnail to `uploads/thumbnails/`
- Generate document_id (UUID)
- Create document record trong MongoDB
- Update user's uploaded_documents

**BÆ°á»›c 9: Response**
```json
{
  "success": true,
  "message": "Upload tÃ i liá»‡u thÃ nh cÃ´ng",
  "data": {
    "document_id": "doc_...",
    "title": "...",
    "file": {...},
    "thumbnail": "..."
  }
}
```

---

### 2. Luá»“ng TÃ¬m Kiáº¿m TÃ i Liá»‡u

#### SÆ¡ Äá»“ Luá»“ng
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Nháº­p tá»« khÃ³a hoáº·c chá»n filters
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Search Bar     â”‚
â”‚  - Query text   â”‚
â”‚  - Program      â”‚
â”‚  - Tags         â”‚
â”‚  - Category     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Click "TÃ¬m kiáº¿m"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/      â”‚
â”‚  documents/     â”‚
â”‚  search?q=...   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. HTTP Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Proxy to Document Service
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Build MongoDB query
       â”‚    - Text search on title, description
       â”‚    - Filter by program
       â”‚    - Filter by tags
       â”‚    - Filter by category
       â”‚    - Sort by relevance/date/downloads
       â”‚    - Pagination
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MongoDB Query  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Execute query
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Results        â”‚
â”‚  - Documents    â”‚
â”‚  - Pagination   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Return to Frontend
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚
â”‚  - Display      â”‚
â”‚    results      â”‚
â”‚  - Show cards   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User nháº­p tá»« khÃ³a**
- Search bar trÃªn header hoáº·c trang documents
- CÃ³ thá»ƒ káº¿t há»£p vá»›i filters:
  - Program (CNTT, Kinh táº¿, ...)
  - Tags
  - Category
  - File type
  - Year

**BÆ°á»›c 2: Frontend gá»­i request**
```javascript
GET /api/documents/search?q=toÃ¡n há»c&program=CNTT&limit=20&page=1
```

**BÆ°á»›c 3-4: API Gateway â†’ Document Service**

**BÆ°á»›c 5: Document Service xá»­ lÃ½**
- Build MongoDB query:
  ```javascript
  {
    $text: { $search: "toÃ¡n há»c" },
    program: "CNTT",
    visibility: "public",
    status: "published"
  }
  ```
- Apply pagination
- Sort results
- Populate author info

**BÆ°á»›c 6: MongoDB execute query**
- Text search trÃªn indexed fields
- Filter documents
- Return results

**BÆ°á»›c 7: Response**
```json
{
  "success": true,
  "data": {
    "documents": [...],
    "pagination": {
      "currentPage": 1,
      "totalPages": 10,
      "totalDocuments": 200,
      "limit": 20
    }
  }
}
```

**BÆ°á»›c 8: Frontend hiá»ƒn thá»‹**
- Render document cards
- Show pagination controls
- Update URL vá»›i query params

---

### 3. Luá»“ng Xem Chi Tiáº¿t TÃ i Liá»‡u

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Click on Document Card
    â†“
Navigate to /documents/:id
    â†“
GET /api/documents/:id
    â†“
Document Service
    â”œâ”€ Find document by ID
    â”œâ”€ Populate author info
    â”œâ”€ Get ratings
    â”œâ”€ Calculate average rating
    â””â”€ Increment views
    â†“
Return document details
    â†“
Frontend display
    â”œâ”€ Document info
    â”œâ”€ Author info
    â”œâ”€ Download button
    â”œâ”€ Bookmark button
    â”œâ”€ Rating section
    â””â”€ Related documents
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User click vÃ o document card**
- Navigate to `/documents/:id`

**BÆ°á»›c 2: Frontend fetch document**
```javascript
GET /api/documents/:id
```

**BÆ°á»›c 3: Document Service**
- Find document by ID
- Populate author information
- Get ratings tá»« DocumentRatings collection
- Calculate average rating
- Increment views count
- Get related documents (same tags)

**BÆ°á»›c 4: Response**
```json
{
  "success": true,
  "data": {
    "document_id": "...",
    "title": "...",
    "description": "...",
    "author": {...},
    "file": {...},
    "downloads": 100,
    "views": 501,
    "rating": 4.5,
    "ratingCount": 20,
    "tags": [...],
    "relatedDocuments": [...]
  }
}
```

**BÆ°á»›c 5: Frontend hiá»ƒn thá»‹**
- Document details
- Author profile
- Download button
- Bookmark button
- Rating vÃ  comments
- Related documents

---

### 4. Luá»“ng Táº£i Xuá»‘ng TÃ i Liá»‡u

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Document Detail Page â†’ Click "Táº£i xuá»‘ng"
    â†“
POST /api/documents/:id/download
    â†“
Document Service
    â”œâ”€ Find document
    â”œâ”€ Increment downloads
    â”œâ”€ Log download
    â””â”€ Return file URL
    â†“
Frontend
    â”œâ”€ Open file in new tab
    â””â”€ Or trigger download
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User click "Táº£i xuá»‘ng"**
- Button trÃªn document detail page

**BÆ°á»›c 2: Frontend gá»­i request**
```javascript
POST /api/documents/:id/download
```

**BÆ°á»›c 3: Document Service**
- Find document
- Increment downloads count
- Save to MongoDB
- Return file URL

**BÆ°á»›c 4: Frontend xá»­ lÃ½**
- Open file URL in new tab
- Hoáº·c trigger browser download

---

### 5. Luá»“ng Bookmark TÃ i Liá»‡u

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Document Detail â†’ Click Bookmark Icon
    â†“
POST /api/documents/bookmarks
Body: { userId, documentId }
    â†“
Document Service
    â”œâ”€ Find user
    â”œâ”€ Check if already bookmarked
    â”œâ”€ Add to saved_documents
    â””â”€ Save to MongoDB
    â†“
Response: Success
    â†“
Frontend update UI (filled icon)
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User click bookmark icon**
- Icon trÃªn document card hoáº·c detail page

**BÆ°á»›c 2: Frontend gá»­i request**
```javascript
POST /api/documents/bookmarks
Body: {
  userId: "user_123",
  documentId: "doc_456"
}
```

**BÆ°á»›c 3: Document Service**
- Find user trong UserCollection
- Check if documentId Ä‘Ã£ cÃ³ trong saved_documents
- If not, add documentId to array
- Save to MongoDB

**BÆ°á»›c 4: Response**
```json
{
  "success": true,
  "message": "ÄÃ£ thÃªm vÃ o bookmark"
}
```

**BÆ°á»›c 5: Frontend update**
- Change icon to filled
- Show success message

---

### 6. Luá»“ng ÄÃ¡nh GiÃ¡ TÃ i Liá»‡u

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Document Detail â†’ Rating Section
    â†“
Chá»n sá»‘ sao (1-5) vÃ  nháº­p comment
    â†“
POST /api/rating
Body: {
  document_id,
  user_id,
  rating,
  comment
}
    â†“
Rating Service (via Forum Service)
    â”œâ”€ Validate rating (1-5)
    â”œâ”€ Check if already rated
    â”œâ”€ Create rating record
    â”œâ”€ Calculate new average
    â””â”€ Update document rating
    â†“
Response: Success
    â†“
Frontend update rating display
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User Ä‘Ã¡nh giÃ¡**
- Chá»n sá»‘ sao (1-5)
- Nháº­p comment (optional)

**BÆ°á»›c 2: Frontend gá»­i request**
```javascript
POST /api/rating
Body: {
  document_id: "doc_123",
  user_id: "user_456",
  rating: 5,
  comment: "TÃ i liá»‡u ráº¥t hay"
}
```

**BÆ°á»›c 3: Rating Service**
- Validate rating (1-5)
- Check if user Ä‘Ã£ Ä‘Ã¡nh giÃ¡ document nÃ y
- Create rating record trong DocumentRatings collection
- Calculate new average rating
- Update document's rating vÃ  ratingCount

**BÆ°á»›c 4: Response**
```json
{
  "success": true,
  "message": "ÄÃ¡nh giÃ¡ thÃ nh cÃ´ng",
  "data": {
    "rating_id": "...",
    "rating": 5,
    "comment": "..."
  }
}
```

---

## Luá»“ng Quáº£n LÃ½ KhÃ³a Há»c

### 1. Luá»“ng Xem Danh SÃ¡ch KhÃ³a Há»c

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Navigate to /courses
    â†“
GET /api/courses?limit=20&page=1
    â†“
Course Service
    â”œâ”€ Build query
    â”œâ”€ Apply filters
    â”œâ”€ Sort courses
    â”œâ”€ Paginate results
    â””â”€ Populate instructor info
    â†“
Return courses list
    â†“
Frontend display course cards
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User truy cáº­p trang courses**
- URL: `/courses`

**BÆ°á»›c 2: Frontend fetch courses**
```javascript
GET /api/courses?limit=20&page=1&sortBy=newest&category=Láº­p trÃ¬nh
```

**BÆ°á»›c 3: Course Service**
- Build MongoDB query
- Apply filters (category, level, isFree, status)
- Sort by newest/popular/price
- Paginate results
- Populate instructor information

**BÆ°á»›c 4: Response**
```json
{
  "success": true,
  "data": {
    "courses": [...],
    "pagination": {...}
  }
}
```

**BÆ°á»›c 5: Frontend hiá»ƒn thá»‹**
- Course cards vá»›i thumbnail
- Instructor info
- Price/free badge
- Enrollment count
- Rating

---

### 2. Luá»“ng Xem Chi Tiáº¿t KhÃ³a Há»c

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Click Course Card
    â†“
Navigate to /course/:id
    â†“
GET /api/courses/:id
    â†“
Course Service
    â”œâ”€ Find course by ID
    â”œâ”€ Populate instructor
    â”œâ”€ Get lessons/modules
    â”œâ”€ Get enrollment count
    â”œâ”€ Calculate rating
    â””â”€ Check if user enrolled
    â†“
Return course details
    â†“
Frontend display
    â”œâ”€ Course info
    â”œâ”€ Instructor profile
    â”œâ”€ Lessons list
    â”œâ”€ Enroll button
    â””â”€ Reviews
```

---

### 3. Luá»“ng ÄÄƒng KÃ½ KhÃ³a Há»c

#### SÆ¡ Äá»“ Luá»“ng
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Click "ÄÄƒng kÃ½ khÃ³a há»c"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Login    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Not logged in â†’ Redirect to /signin
       â”‚
       â””â”€ Logged in â†’ Continue
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Course   â”‚
â”‚  isFree?        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Free â†’ Direct Enrollment
       â”‚  â”‚
       â”‚  â–¼
       â”‚  POST /api/courses/:id/enroll
       â”‚  â”‚
       â”‚  â–¼
       â”‚  Course Service
       â”‚  â”œâ”€ Check if already enrolled
       â”‚  â”œâ”€ Create enrollment record
       â”‚  â”œâ”€ Update user.enrolled_courses
       â”‚  â””â”€ Update course.enrollmentCount
       â”‚  â”‚
       â”‚  â–¼
       â”‚  Response: Success
       â”‚  â”‚
       â”‚  â–¼
       â”‚  Frontend: Show success, redirect to course
       â”‚
       â””â”€ Paid â†’ Payment Flow
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Payment â”‚
â”‚  POST /api/     â”‚
â”‚  payments/createâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Create payment link
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Course Service â”‚
â”‚  - Create       â”‚
â”‚    payment      â”‚
â”‚    record       â”‚
â”‚  - Call PayOS   â”‚
â”‚    API          â”‚
â”‚  - Generate     â”‚
â”‚    payment link â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Return payment link
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend        â”‚
â”‚  - Redirect to  â”‚
â”‚    payment page â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. User completes payment
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PayOS           â”‚
â”‚  - Process       â”‚
â”‚    payment       â”‚
â”‚  - Webhook       â”‚
â”‚    callback      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Webhook to Course Service
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Course Service â”‚
â”‚  - Verify       â”‚
â”‚    payment      â”‚
â”‚  - Update       â”‚
â”‚    payment      â”‚
â”‚    status       â”‚
â”‚  - Create       â”‚
â”‚    enrollment   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Enrollment created
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend        â”‚
â”‚  - Poll payment â”‚
â”‚    status       â”‚
â”‚  - Show success â”‚
â”‚  - Redirect to  â”‚
â”‚    course       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User click "ÄÄƒng kÃ½"**
- Check if user is logged in
- If not, redirect to signin

**BÆ°á»›c 2: Check course pricing**
- If free: Direct enrollment
- If paid: Create payment

**BÆ°á»›c 3: Free Course Enrollment**
```javascript
POST /api/courses/:id/enroll
Body: { user_id: "user_123" }
```

**Course Service xá»­ lÃ½**:
- Check if already enrolled
- Create enrollment record trong Enrollments collection
- Update user.enrolled_courses
- Update course.enrollmentCount
- Return enrollment confirmation

**BÆ°á»›c 4: Paid Course - Create Payment**
```javascript
POST /api/payments/create
Body: {
  course_id: "course_123",
  user_id: "user_456",
  amount: 500000,
  description: "Thanh toÃ¡n khÃ³a há»c..."
}
```

**Course Service xá»­ lÃ½**:
- Create payment record trong Payments collection
- Call PayOS API Ä‘á»ƒ táº¡o payment link
- Generate payment_id
- Return payment link

**BÆ°á»›c 5: User completes payment**
- Redirect to PayOS payment page
- User completes payment
- PayOS processes payment

**BÆ°á»›c 6: PayOS Webhook**
- PayOS sends webhook callback
- Course Service verifies payment
- Updates payment status
- Creates enrollment automatically

**BÆ°á»›c 7: Frontend polling**
- Frontend polls payment status
- When status = "paid", show success
- Redirect to course learning page

---

### 4. Luá»“ng Há»c Táº­p KhÃ³a Há»c

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ My Courses â†’ Select Course
    â†“
Navigate to /course/:id/learn
    â†“
GET /api/courses/:id/enrollment?userId=...
    â†“
Course Service
    â”œâ”€ Find enrollment
    â”œâ”€ Get course details
    â”œâ”€ Get lessons
    â””â”€ Get progress
    â†“
Return enrollment data
    â†“
Frontend display
    â”œâ”€ Course content
    â”œâ”€ Lessons list
    â”œâ”€ Video player
    â”œâ”€ Progress bar
    â””â”€ Next/Previous buttons
```

#### Cáº­p Nháº­t Tiáº¿n Äá»™
```
User â†’ Complete Lesson
    â†“
PUT /api/courses/:id/progress
Body: {
  userId,
  progress: 50,
  completedLessons: ["lesson_1", "lesson_2"]
}
    â†“
Course Service
    â”œâ”€ Find enrollment
    â”œâ”€ Update progress
    â”œâ”€ Update completed_lessons
    â””â”€ Check if course completed
    â†“
Response: Updated progress
    â†“
Frontend update progress bar
```

---

## Luá»“ng Thanh ToÃ¡n

### 1. Luá»“ng Táº¡o Payment Link

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Enroll Paid Course
    â†“
POST /api/payments/create
    â†“
Course Service
    â”œâ”€ Create payment record
    â”œâ”€ Call PayOS API
    â”‚  â”œâ”€ Prepare payment data
    â”‚  â”œâ”€ Generate signature
    â”‚  â””â”€ Create payment link
    â”œâ”€ Save payment_id
    â””â”€ Return payment link
    â†“
Frontend
    â”œâ”€ Store payment info
    â””â”€ Redirect to payment page
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User initiates payment**
- Click "ÄÄƒng kÃ½" trÃªn paid course

**BÆ°á»›c 2: Frontend gá»­i request**
```javascript
POST /api/payments/create
Body: {
  course_id: "course_123",
  user_id: "user_456",
  amount: 500000,
  description: "Thanh toÃ¡n khÃ³a há»c láº­p trÃ¬nh"
}
```

**BÆ°á»›c 3: Course Service xá»­ lÃ½**
- Create payment record:
  ```javascript
  {
    payment_id: "payment_...",
    course_id: "...",
    user_id: "...",
    amount: 500000,
    status: "pending",
    created_at: Date
  }
  ```
- Call PayOS API:
  - Prepare payment data
  - Generate HMAC SHA256 signature
  - Create payment link
- Save payment_id vÃ  payment_link

**BÆ°á»›c 4: Response**
```json
{
  "success": true,
  "data": {
    "payment_id": "payment_...",
    "payment_link": "https://pay.payos.vn/web/...",
    "amount": 500000,
    "status": "pending"
  }
}
```

**BÆ°á»›c 5: Frontend xá»­ lÃ½**
- Store payment info in localStorage
- Redirect to payment page (`/payment/va`)
- Display payment link button

---

### 2. Luá»“ng Thanh ToÃ¡n PayOS

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Payment Page â†’ Click "Thanh toÃ¡n"
    â†“
Open PayOS Payment Link
    â†“
PayOS Payment Page
    â”œâ”€ User enters payment info
    â”œâ”€ Select payment method
    â””â”€ Confirm payment
    â†“
PayOS Processes Payment
    â”œâ”€ Bank transfer
    â”œâ”€ E-wallet
    â””â”€ Credit card
    â†“
Payment Success/Failure
    â†“
PayOS Webhook Callback
    POST /api/payments/callback
    â†“
Course Service
    â”œâ”€ Verify signature
    â”œâ”€ Update payment status
    â”œâ”€ If paid: Create enrollment
    â””â”€ Update course enrollmentCount
    â†“
Frontend Polls Status
    GET /api/payments/:payment_id/status
    â†“
When status = "paid"
    â”œâ”€ Show success
    â””â”€ Redirect to course
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User clicks payment button**
- Open PayOS payment link in new tab

**BÆ°á»›c 2: PayOS payment page**
- User enters payment information
- Select payment method
- Confirm payment

**BÆ°á»›c 3: PayOS processes**
- Process payment through selected method
- Return success/failure

**BÆ°á»›c 4: PayOS webhook**
- PayOS sends callback to:
  ```
  POST /api/payments/callback
  ```
- Includes payment status vÃ  signature

**BÆ°á»›c 5: Course Service verifies**
- Verify HMAC signature
- Update payment status trong Payments collection
- If status = "paid":
  - Create enrollment record
  - Update user.enrolled_courses
  - Update course.enrollmentCount

**BÆ°á»›c 6: Frontend polling**
- Frontend polls payment status:
  ```javascript
  GET /api/payments/:payment_id/status
  ```
- When status = "paid":
  - Show success message
  - Redirect to course learning page

---

## Luá»“ng Forum & Blog

### 1. Luá»“ng ÄÄƒng BÃ i Forum

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Forum Page â†’ Click "ÄÄƒng bÃ i"
    â†“
Create Post Form
    â”œâ”€ Title
    â”œâ”€ Content
    â”œâ”€ Tags
    â””â”€ Optional images
    â†“
POST /api/forum/posts
    â†“
Forum Service
    â”œâ”€ Validate input
    â”œâ”€ Save images (if any)
    â”œâ”€ Create post record
    â””â”€ Save to MongoDB
    â†“
Response: Post created
    â†“
Frontend
    â”œâ”€ Show success
    â””â”€ Refresh posts list
```

#### CÃ¡c BÆ°á»›c Chi Tiáº¿t

**BÆ°á»›c 1: User táº¡o bÃ i Ä‘Äƒng**
- Fill form vá»›i title, content, tags
- Optional: Upload images

**BÆ°á»›c 2: Frontend gá»­i request**
```javascript
POST /api/forum/posts
Body: {
  title: "CÃ¢u há»i vá»...",
  content: "Ná»™i dung cÃ¢u há»i",
  author_id: "user_123",
  tags: ["láº­p trÃ¬nh", "javascript"]
}
```

**BÆ°á»›c 3: Forum Service xá»­ lÃ½**
- Validate input
- If images: Save to uploads/images/
- Create post record trong posts collection
- Generate post_id

**BÆ°á»›c 4: Response**
```json
{
  "success": true,
  "message": "ÄÄƒng bÃ i thÃ nh cÃ´ng",
  "data": {
    "id": "...",
    "title": "...",
    "created_at": "..."
  }
}
```

---

### 2. Luá»“ng Comment & Like

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Post Detail â†’ Comment Section
    â†“
Enter Comment
    â†“
POST /api/forum/posts/:id/comments
    â†“
Forum Service
    â”œâ”€ Find post
    â”œâ”€ Add comment to comments array
    â””â”€ Save to MongoDB
    â†“
Response: Comment added
    â†“
Frontend update comments list
```

#### Like/Unlike Flow
```
User â†’ Click Like Button
    â†“
POST /api/forum/posts/:id/like
Body: { userId }
    â†“
Forum Service
    â”œâ”€ Find post
    â”œâ”€ Check if user already liked
    â”‚  â”œâ”€ Yes â†’ Remove from likes array
    â”‚  â””â”€ No â†’ Add to likes array
    â”œâ”€ Update likes count
    â””â”€ Save to MongoDB
    â†“
Response: { liked: true/false, likes: count }
    â†“
Frontend update like button
```

---

### 3. Luá»“ng Xem Blog

#### SÆ¡ Äá»“ Luá»“ng
```
User â†’ Blog Page
    â†“
GET /api/blogs?limit=20&page=1
    â†“
Blog Service
    â”œâ”€ Get blog posts
    â”œâ”€ Apply filters
    â”œâ”€ Sort by newest/popular
    â””â”€ Paginate
    â†“
Return blog posts
    â†“
Frontend display
    â”œâ”€ Featured posts
    â”œâ”€ Popular posts
    â””â”€ All posts
```

#### Xem Chi Tiáº¿t Blog
```
User â†’ Click Blog Post
    â†“
GET /api/blogs/:id
    â†“
Blog Service
    â”œâ”€ Find post by ID
    â”œâ”€ Increment views
    â”œâ”€ Get related posts
    â””â”€ Return post details
    â†“
Frontend display
    â”œâ”€ Post content
    â”œâ”€ Author info
    â”œâ”€ Tags
    â””â”€ Related posts
```

---

## Luá»“ng Quáº£n Trá»‹

### 1. Luá»“ng ÄÄƒng Nháº­p Admin

#### SÆ¡ Äá»“ Luá»“ng
```
Admin â†’ /administrator
    â†“
Enter credentials
    â†“
POST /api/auth/login
    â†“
Auth Service
    â”œâ”€ Verify credentials
    â”œâ”€ Check role = "admin"
    â””â”€ Generate JWT token
    â†“
Response: Token + User (role: admin)
    â†“
Frontend
    â”œâ”€ Store token
    â””â”€ Redirect to /administrator/manager-dashboard
```

---

### 2. Luá»“ng Quáº£n LÃ½ Users

#### SÆ¡ Äá»“ Luá»“ng
```
Admin â†’ Dashboard â†’ Users Tab
    â†“
GET /api/admin/users
Headers: { Authorization: Bearer <token> }
    â†“
API Gateway
    â”œâ”€ Verify JWT token
    â””â”€ Proxy to Auth Service
    â†“
Auth Service
    â”œâ”€ Verify token
    â”œâ”€ Check role = "admin"
    â”œâ”€ Get all users
    â””â”€ Remove passwords from response
    â†“
Return users list
    â†“
Frontend display
    â”œâ”€ Users table
    â”œâ”€ Search & filter
    â””â”€ Action buttons
```

#### CÃ¡c Thao TÃ¡c Admin

**1. Xem User Chi Tiáº¿t**
```
GET /api/admin/users/:id
â†’ Return user details
```

**2. Cáº­p Nháº­t User**
```
PUT /api/admin/users/:id
Body: {
  role: "instructor",
  is_active: true,
  is_verified: true
}
â†’ Update user fields
```

**3. XÃ³a/KhÃ³a User**
```
DELETE /api/admin/users/:id
â†’ Set is_active = false
Hoáº·c xÃ³a user khá»i database
```

---

### 3. Luá»“ng Thá»‘ng KÃª

#### SÆ¡ Äá»“ Luá»“ng
```
Admin â†’ Dashboard â†’ Statistics
    â†“
GET /api/courses/stats
GET /api/documents (with aggregation)
    â†“
Services return statistics
    â”œâ”€ Total courses
    â”œâ”€ Total documents
    â”œâ”€ Total users
    â”œâ”€ Total enrollments
    â””â”€ Revenue (if applicable)
    â†“
Frontend display charts
```

---

## Tá»•ng Káº¿t Luá»“ng Nghiá»‡p Vá»¥

### Luá»“ng Nghiá»‡p Vá»¥ ChÃ­nh

#### 1. User Journey - NgÆ°á»i DÃ¹ng Má»›i
```
1. Truy cáº­p trang chá»§
   â†“
2. Xem tÃ i liá»‡u (khÃ´ng cáº§n Ä‘Äƒng nháº­p)
   â†“
3. ÄÄƒng kÃ½ tÃ i khoáº£n
   â†“
4. ÄÄƒng nháº­p
   â†“
5. Upload tÃ i liá»‡u Ä‘áº§u tiÃªn
   â†“
6. TÃ¬m kiáº¿m vÃ  bookmark tÃ i liá»‡u
   â†“
7. ÄÄƒng kÃ½ khÃ³a há»c miá»…n phÃ­
   â†“
8. Thanh toÃ¡n khÃ³a há»c cÃ³ phÃ­
   â†“
9. Há»c táº­p vÃ  cáº­p nháº­t tiáº¿n Ä‘á»™
   â†“
10. ÄÃ¡nh giÃ¡ tÃ i liá»‡u vÃ  khÃ³a há»c
```

#### 2. Content Creator Journey
```
1. ÄÄƒng kÃ½ vá»›i role = "instructor"
   â†“
2. Upload nhiá»u tÃ i liá»‡u
   â†“
3. Táº¡o khÃ³a há»c
   â†“
4. Quáº£n lÃ½ khÃ³a há»c
   â†“
5. Xem thá»‘ng kÃª Ä‘Ã³ng gÃ³p
   â†“
6. TÆ°Æ¡ng tÃ¡c vá»›i há»c viÃªn
```

#### 3. Admin Journey
```
1. ÄÄƒng nháº­p vá»›i role = "admin"
   â†“
2. Xem dashboard thá»‘ng kÃª
   â†“
3. Quáº£n lÃ½ users
   â”‚  â”œâ”€ Xem danh sÃ¡ch
   â”‚  â”œâ”€ KhÃ³a/Má»Ÿ khÃ³a tÃ i khoáº£n
   â”‚  â””â”€ Thay Ä‘á»•i role
   â†“
4. Quáº£n lÃ½ ná»™i dung
   â”‚  â”œâ”€ Duyá»‡t tÃ i liá»‡u
   â”‚  â”œâ”€ XÃ³a ná»™i dung khÃ´ng phÃ¹ há»£p
   â”‚  â””â”€ Quáº£n lÃ½ khÃ³a há»c
   â†“
5. Xem bÃ¡o cÃ¡o vÃ  thá»‘ng kÃª
```

### Luá»“ng Xá»­ LÃ½ Lá»—i

#### Error Handling Flow
```
Request â†’ Service
    â†“
Error Occurs
    â†“
Error Handler
    â”œâ”€ Log error
    â”œâ”€ Format error response
    â””â”€ Send to API Gateway
    â†“
API Gateway
    â”œâ”€ Log error
    â”œâ”€ Transform error (if needed)
    â””â”€ Send to Frontend
    â†“
Frontend
    â”œâ”€ Display error message
    â””â”€ Handle error state
```

### Luá»“ng Báº£o Máº­t

#### Authentication Flow
```
Protected Route
    â†“
Check JWT Token
    â”œâ”€ No token â†’ Redirect to login
    â”œâ”€ Invalid token â†’ Return 401
    â””â”€ Valid token â†’ Continue
    â†“
Check Role (if required)
    â”œâ”€ Wrong role â†’ Return 403
    â””â”€ Correct role â†’ Allow access
    â†“
Process Request
```

### Tá»•ng Káº¿t CÃ¡c Luá»“ng

| Luá»“ng | Endpoint | Service | Authentication |
|-------|----------|---------|----------------|
| ÄÄƒng kÃ½ | POST /api/auth/register | Auth | KhÃ´ng |
| ÄÄƒng nháº­p | POST /api/auth/login | Auth | KhÃ´ng |
| Upload tÃ i liá»‡u | POST /api/documents/upload | Document | CÃ³ (User) |
| TÃ¬m kiáº¿m | GET /api/documents/search | Document | KhÃ´ng |
| Xem tÃ i liá»‡u | GET /api/documents/:id | Document | KhÃ´ng |
| Bookmark | POST /api/documents/bookmarks | Document | CÃ³ (User) |
| ÄÃ¡nh giÃ¡ | POST /api/rating | Rating | CÃ³ (User) |
| ÄÄƒng kÃ½ khÃ³a há»c | POST /api/courses/:id/enroll | Course | CÃ³ (User) |
| Thanh toÃ¡n | POST /api/payments/create | Course | CÃ³ (User) |
| Quáº£n lÃ½ users | GET /api/admin/users | Auth | CÃ³ (Admin) |
| ÄÄƒng bÃ i forum | POST /api/forum/posts | Forum | CÃ³ (User) |
| Xem blog | GET /api/blogs | Blog | KhÃ´ng |

---

**TÃ i liá»‡u Ä‘Æ°á»£c cáº­p nháº­t láº§n cuá»‘i: 2024-01-15**

**Ghi chÃº**: Táº¥t cáº£ cÃ¡c luá»“ng nghiá»‡p vá»¥ Ä‘á»u Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Ä‘áº£m báº£o tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng tá»‘t nháº¥t vÃ  báº£o máº­t cao. CÃ¡c luá»“ng cÃ³ thá»ƒ Ä‘Æ°á»£c má»Ÿ rá»™ng vÃ  tá»‘i Æ°u hÃ³a trong tÆ°Æ¡ng lai.

